/*
  File           : MailAgent.cs

  Description    : Wrapper class for Oracle package MailAgent.
                   This code was generated, do not edit.

*/
#define ODP_NET
using System;
using System.Data;
#if ODP_NET
using Oracle.DataAccess.Client;
#else
using System.Data.OracleClient;
#endif
using Imi.Framework.Job.Data;

namespace Imi.SupplyChain.Server.Job.MailAgent.PLSQLInterface
{
    public class DbMailAgent
    {
        private IDbConnectionProvider connectionProvider;

        public string _Debug()
        {
            return "Package        : MAILAGENT\r\n" +
              "Generated on   : 2005-09-02 10:56:22\r\n" +
              "Generated by   : IMINT1\\olla@IMIPC1091\r\n" +
              "Generated in   : C:\\TEMP\\wscc\r\n";
        }

        public DbMailAgent(IDbConnectionProvider connectionProvider)
        {
            this.connectionProvider = connectionProvider;
        }

        private IDbCommand sp_ModifyError;
        private IDbCommand sp_ModifySend;
        private IDbCommand sp_GetMAILBOXCur;
        private IDbCommand currentCommand;
        private object     syncLock = new object();

        // ----------------------------------------------------------------------------

        private void CreateSP_ModifyError()
        {
            IDbDataParameter p;

            sp_ModifyError = connectionProvider.GetConnection().CreateCommand();
            sp_ModifyError.CommandText = "MAILAGENT.MODIFY_ERROR";
            sp_ModifyError.CommandType = System.Data.CommandType.StoredProcedure;
#if ODP_NET
            ((OracleCommand)sp_ModifyError).BindByName = true;
#endif


            p = sp_ModifyError.CreateParameter();
            p.ParameterName = "MAILID_I";
            p.DbType = DbType.String;
            p.Size = 255;
            p.Direction = ParameterDirection.Input;
            sp_ModifyError.Parameters.Add(p);

            p = sp_ModifyError.CreateParameter();
            p.ParameterName = "ERRORMESSAGE_I";
            p.DbType = DbType.String;
            p.Size = 255;
            p.Direction = ParameterDirection.Input;
            sp_ModifyError.Parameters.Add(p);

            p = sp_ModifyError.CreateParameter();
            p.ParameterName = "ALMID_O";
            p.DbType = DbType.String;
            p.Size = 255;
            p.Direction = ParameterDirection.Output;
            sp_ModifyError.Parameters.Add(p);
        }

        private void CreateSP_ModifySend()
        {
            IDbDataParameter p;

            sp_ModifySend = connectionProvider.GetConnection().CreateCommand();
            sp_ModifySend.CommandText = "MAILAGENT.MODIFY_SEND";
            sp_ModifySend.CommandType = System.Data.CommandType.StoredProcedure;
#if ODP_NET
            ((OracleCommand)sp_ModifySend).BindByName = true;
#endif


            p = sp_ModifySend.CreateParameter();
            p.ParameterName = "MAILID_I";
            p.DbType = DbType.String;
            p.Size = 255;
            p.Direction = ParameterDirection.Input;
            sp_ModifySend.Parameters.Add(p);

            p = sp_ModifySend.CreateParameter();
            p.ParameterName = "ALMID_O";
            p.DbType = DbType.String;
            p.Size = 255;
            p.Direction = ParameterDirection.Output;
            sp_ModifySend.Parameters.Add(p);
        }

        private void CreateSP_GetMAILBOXCur()
        {
            sp_GetMAILBOXCur = connectionProvider.GetConnection().CreateCommand();
            sp_GetMAILBOXCur.CommandText = "MAILAGENT.GET_MAILBOX_CUR";
            sp_GetMAILBOXCur.CommandType = System.Data.CommandType.StoredProcedure;
#if ODP_NET
            ((OracleCommand)sp_GetMAILBOXCur).BindByName = true;
#endif

            OracleParameter oP = sp_GetMAILBOXCur.CreateParameter() as OracleParameter;
            oP.ParameterName = "MAILBOX_Cur_O";
#if ODP_NET
            oP.OracleDbType = OracleDbType.RefCursor;
#else
            oP.OracleType = OracleType.Cursor;
#endif
            oP.Direction = ParameterDirection.Output;
            sp_GetMAILBOXCur.Parameters.Add(oP);
        }

        // ----------------------------------------------------------------------------

        public void ModifyError(string MAILID_I,
          string ERRORMESSAGE_I,
          ref string ALMID_O)
        {
            if (sp_ModifyError == null)
                CreateSP_ModifyError();

            sp_ModifyError.Transaction = connectionProvider.CurrentTransaction; 

            lock (syncLock)
            {
                currentCommand = sp_ModifyError;
            }

            // Set In Parameters

            if (String.IsNullOrEmpty(MAILID_I))
                (sp_ModifyError.Parameters["MAILID_I"] as IDbDataParameter).Value = DBNull.Value;
            else
                (sp_ModifyError.Parameters["MAILID_I"] as IDbDataParameter).Value = MAILID_I;

            if (String.IsNullOrEmpty(ERRORMESSAGE_I))
                (sp_ModifyError.Parameters["ERRORMESSAGE_I"] as IDbDataParameter).Value = DBNull.Value;
            else
                (sp_ModifyError.Parameters["ERRORMESSAGE_I"] as IDbDataParameter).Value = ERRORMESSAGE_I;

            // Execute stored procedure

            sp_ModifyError.Prepare();
            sp_ModifyError.ExecuteNonQuery();

            // Set Out Parameters

            if ((sp_ModifyError.Parameters["ALMID_O"] as IDbDataParameter).Value == DBNull.Value)
                ALMID_O = "";
            else
                ALMID_O = (sp_ModifyError.Parameters["ALMID_O"] as IDbDataParameter).Value.ToString();
        }

        public void ModifySend(string MAILID_I,
          ref string ALMID_O)
        {
            if (sp_ModifySend == null)
                CreateSP_ModifySend();

            sp_ModifySend.Transaction = connectionProvider.CurrentTransaction;

            lock (syncLock)
            {
                currentCommand = sp_ModifySend;
            }

            // Set In Parameters

            if (String.IsNullOrEmpty(MAILID_I))
                (sp_ModifySend.Parameters["MAILID_I"] as IDbDataParameter).Value = DBNull.Value;
            else
                (sp_ModifySend.Parameters["MAILID_I"] as IDbDataParameter).Value = MAILID_I;

            // Execute stored procedure

            sp_ModifySend.Prepare();
            sp_ModifySend.ExecuteNonQuery();

            // Set Out Parameters

            if ((sp_ModifySend.Parameters["ALMID_O"] as IDbDataParameter).Value == DBNull.Value)
                ALMID_O = "";
            else
                ALMID_O = (sp_ModifySend.Parameters["ALMID_O"] as IDbDataParameter).Value.ToString();
        }

        public IDataReader GetMAILBOXCur()
        {
            if (sp_GetMAILBOXCur == null)
                CreateSP_GetMAILBOXCur();

            sp_GetMAILBOXCur.Transaction = connectionProvider.CurrentTransaction;

            lock (syncLock)
            {
                currentCommand = sp_GetMAILBOXCur;
            }

            // Set In Parameters

            // Execute stored procedure

            sp_GetMAILBOXCur.Prepare();
            IDataReader r = sp_GetMAILBOXCur.ExecuteReader();

            return r;
        }

        public void Cancel()
        {
            lock (syncLock)
            {
                if (currentCommand != null)
                {
                    if (currentCommand.Connection != null)
                    {
                        if (currentCommand.Connection.State != ConnectionState.Closed)
                        {
                            currentCommand.Cancel();
                        }
                    }
                }
            }
        }


    }
}
